<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.shoestore.mapper.ShoeStoreMapper">

<sql id="brand">
	where s.bno in <foreach collection="bno" item="item" open="(" close=")" separator=",">#{item}</foreach>
</sql>
<sql id="kind">
	where s.kno in <foreach collection="kno" item="item" open="(" close=")" separator=",">#{item}</foreach>
</sql>
<sql id="color">
	where s.color = #{color}
</sql>


<!-- 신발 업로드 -->
<insert id="shoesRegister" parameterType="Shoes">
	insert into shoes(shoesname, color, contents, image, price, indate, bno, kno)
				 values(#{shoesname}, #{color}, #{contents}, #{image}, #{price}, #{indate}, #{bno}, #{kno})
</insert>

<!-- 신발 전체 목록 가져오기 -->
<select id="shoesSelect" parameterType="hashMap" resultType="Shoes" >
	select s.sno, b.brand, k.kind, s.shoesname, s.color, s.image, s.price, s.sale, s.favorites
	from shoes as s					  
		   inner join brand as b on s.bno = b.bno
		   inner join kind as k on s.kno = k.kno
	<choose>
		<when test="bno != null"><include refid="brand"/></when>
		<when test="kno != null"><include refid="kind"/></when>
		<when test="color != null"><include refid="color"/></when>
		<when test="bno != null and kno != null"><include refid="brand"/>and<include refid="kind"/></when> 
		<when test="bno != null and color != null"><include refid="brand"/>and<include refid="color"/></when>
		<when test="kno != null and color != null"><include refid="kind"/>and<include refid="color"/></when>
		<when test="bno != null and kno != null and color != null">
			<include refid="brand"/>and<include refid="kind"/>and<include refid="color"/>
		</when>
	</choose>

<!-- 	<if test="bno != null or kno != null or color != null">
		where s.bno in(#{bno})
	<foreach collection="bno" item="item" index="index" separator="," open="(" close=")">
			#{item}	
		</foreach>  
		and s.kno in
		<foreach collection="kno" item="item" index="index" separator="," open="(" close=")">
			#{item}	
		</foreach> 
		and s.color = #{color}
</if>
 -->
</select>
</mapper>